<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>



    <form id="form-7">
        <h2>Reservations By Date</h2>
        <input type="date" name="dateInp" id="dateInp">
        <button type="submit">Search</button>
    </form>



    <section class="today-reservations">
        <table id="table">
            <tbody id="table-body">
                <tr>
                    <th>Table Number</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Type</th>
                    <th>Number of people</th>
    
                </tr>

            </tbody>
  

        </table>


    </section>

    <h1>Add table</h1>
    <form id="form-1">
        <label for="tableNUM">Table number</label>
        <input type="number" name="tableNUM" id="tableNUM">
        <label for="seats">Number of Seats</label>
        <input type="number" name="seats" id="seats">
        <label for="floor">Floor number</label>
        <input type="number" name="floor" id="floor">
        <label for="type">Type</label>
        <input type="text" name="type" id="type">
        <button type="submit">Add</button>
    </form>

    <h1>Get all Tables</h1>

    <form id="form-2" action="/tables">
        <button type="submit">Get all tables</button>
    </form>

    <h1>Get a single table</h1>

    <form id="form-4">
        <label for="tabNum">Table Number</label>
        <input type="number" name="" id="tabNum">

        <button type="submit">Get table</button>
    </form>


    <h1>Update Tables</h1>

    <form id="form-3">
        <label for="tableNum">Table number</label>
        <input type="number" name="tableNum" id="tableNum">
        <label for="seats">Number of Seats</label>
        <input type="number" name="updseats" id="updseats">
        <label for="floor">Floor number</label>
        <input type="number" name="updfloor" id="updfloor">
        <label for="type">Type</label>
        <input type="text" name="updtype" id="updtype">
        <button type="submit">Add</button>
    </form>
    <h1>Delete table</h1>
    <form id="form-5">
        <label for="deleteNum">Table Number to delete</label>
        <input type="number" id="deleteNum" name="deleteNum">
        <button type="submit">Delete</button>
    </form>



    <script>

        let form7 = document.getElementById("form-7");
        let dateInp = document.getElementById("dateInp");
        form7.addEventListener("submit", (e) => {
            e.preventDefault()
            fetch(`/reserve/${dateInp.value}`, {
                method: "GET",
            }).then(res => res.json())
                .then(data => {
                    const arr = Array.from(data);

                    createHTMLTable(arr,new Date(dateInp.value).toDateString());
                })
        })



        fetch("reserve/today", {
            method: "GET",
        }).then(res => res.json())
            .then(data => {
                const arr = Array.from(data);
                createHTMLTable(arr,new Date().toDateString());
                let deleteButtons = Array.from(document.getElementsByClassName("deleteButton"));
                deleteButtons.forEach(btn => {

                    btn.addEventListener("click", (evt) => {
                        evt.preventDefault()
                        let str = btn.getAttribute('sometime')
                        fetch(`/reserve/delete${btn.value}&${str}`, {
                            method: "DELETE",
                        })

                    })
                })

            });

        function createHTMLTable(arr,date) {
            let parent = document.getElementById("table-body")
            let len = parent.childElementCount;
            for (var i = 1; i < len; i++){
                parent.removeChild(parent.lastChild);
            }

            arr.forEach(elt => {
                let row = document.createElement("tr");
                let col = document.createElement("td");
                let content = document.createTextNode(elt.tableNumber);
                col.appendChild(content);
                let col2 = document.createElement("td");
                let content2 = document.createTextNode(elt.Type);
                col2.appendChild(content2);
                let col3 = document.createElement("td");
                let content3 = document.createTextNode(elt.time);
                col3.appendChild(content3);

                let col4 = document.createElement("td");
                let content4 = document.createTextNode(elt.date);
                col4.appendChild(content4);

                let col5 = document.createElement("td");
                let content5 = document.createTextNode(elt.Number_of_people);
                col5.appendChild(content5);
                row.appendChild(col)
                row.appendChild(col2)
                row.appendChild(col3)
                row.appendChild(col4)
                row.appendChild(col5)
                console.log(date);

                if (date === new Date().toDateString()){
                    let button = document.createElement("button");
                    button.classList.add("deleteButton");
                    let content6 = document.createTextNode("Delete");
                    button.setAttribute("value", elt.tableNumber);
                    button.setAttribute("sometime", elt.time);
                    button.setAttribute("type", "submit");
                    button.appendChild(content6);
                    row.appendChild(button)

                }
 
                document.getElementById("table-body").appendChild(row);
                
            });
            console.log(parent.childElementCount);

        }


        const form = document.getElementById("form-1");
        const seats = document.getElementById("seats");
        const type = document.getElementById("type");
        const floor = document.getElementById("floor");
        const tableNum = document.getElementById("tableNum");
        const tableNUM = document.getElementById("tableNUM");




        form.addEventListener("submit", (e) => {
            e.preventDefault();

            fetch("/tables", {
                method: "POST",
                body: JSON.stringify({
                    seats: seats.value,
                    floor: floor.value,
                    type: type.value,
                    tableNUM: tableNUM.value

                }),
                headers: {
                    "Content-Type": "application/json",
                },

            }).then(response => response.json())
                .then(data => {
                    console.log(data);

                })
        })
        let secForm = document.getElementById("form-2");

        secForm.addEventListener("submit", (e) => {
            fetch("/tables", {
                method: "GET",
            }).then(res => res.json())
                .then(data => console.log(data));
        })
        let updForm = document.getElementById("form-3");

        updForm.addEventListener("submit", (e) => {
            e.preventDefault();
            console.log(document.getElementById("updseats").value)
            fetch(`/tables/${tableNum.value}`, {
                method: "PATCH",
                body: JSON.stringify({
                    updseats: document.getElementById("updseats").value,
                    updfloor: document.getElementById("updfloor").value,
                    updtype: document.getElementById("updtype").value
                }),
                headers: {
                    "Content-Type": "application/json",
                },

            }).then(res => res.json())
                .then(data => console.log(data));
        })

        let form4 = document.getElementById("form-4");
        let tabNum = document.getElementById("tabNum");


        form4.addEventListener("submit", (e) => {
            e.preventDefault();
            fetch(`/tables/${tabNum.value}`, {
                method: "GET",
            }).then(res => res.json())
                .then(data => console.log(data));
        })
        let form5 = document.getElementById("form-5");
        let deleteNum = document.getElementById("deleteNum");
        form5.addEventListener("submit", (e) => {
            fetch(`/tables/${deleteNum.value}`, {
                method: "DELETE",
            }).then(res => res.json())
                .then(data => console.log(data));

        })






    </script>

</body>

</html>

<!-- let sentMessage = document.createElement("div");
let messageContent = document.createTextNode(data.message);
sentMessage.appendChild(messageContent);
document.body.appendChild(sentMessage); -->